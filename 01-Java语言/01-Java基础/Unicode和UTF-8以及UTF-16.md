# Unicode字符集及其编码

## Unicode与UTF-8、UTF-16之间的联系

1. `Unicode`是字符集，将每个字符用一个数字（码点）表示，比如字母`A`对于的码点是`+U0041`。

2. `UTF-8`和`UTF-16`是字符编码，由于`Unicode`只是定义了每个字符对应的码点，但是没有定义这些码点如何存储，而字符编码就是用于定义如何存储码点的，即怎么用字节存储字符。

## Unicode字符集

​	`Unicode`字符集共有17个平面，分别是`U+0000~U+FFFF`（1个基础平面）和`U+10000~U+10FFFF`（16个辅助平面）。

## UTF-16（用2个或4个字节表示一个Unicode字符）

1. 对于基础平面的字符（`U+0000~U+FFFF`之间的），直接用2个字节进行表示即可。

2. 对于辅助平面的字符（`U+10000~U+10FFFF`之间的），需要用4个字节进行表示。

3. **问题**：读到一个16位的数据时，不能确定其是一个基础平面字符还是一个辅助平面字符的高位部分。为了解决该问题，思路如下：

    ① 在基础平面字符中，空出`U+D800~U+DBFF`和`U+DC00~U+DFFF`之间的字符，共2048个字符

    ② 在辅助平面的字符中，用54开头的表示高位，用55开头的表示低位。即每读到16位的数据，如果是以54开头（`1101 10xx xxxx xxxx`），则认为该部分是辅助平面字符的高位部分；如果是以55开头（`1101 11xx xxxx xxxx`），则认为该部分是辅助平面字符的低位部分；否则是基础平面字符。

4. 如何对一个`Unicode`进行`UTF-16`编码呢？以`U+1D546`为例

   ① 将`U+1D546`减去`U+10000`，得到`U+D546`

   ② 将`U+D546`用20位的二进制表示，为`0000110101|0101000110`，将其分为两个10位的二进制，分别是`0000110101`和`0101000110`，其中左半部分为辅助平面字符的高位（`1101 1000 0011 0101`），右半部分为辅助平面字符的低位（`1101 1101 0100 0110`）

   ③ 所以该辅助平面字符可以表示为`U+D835`和`U+DD46`

5. 如何将一个辅助平面字符的高低位整合成一个`Unicode`？以`U+D835`和`U+DD46`为例

   ① 将高位和低位分别用16位的二进制表示，为`1101 1000 0011 0101`和`1101 1101 0100 0110`

   ② 去掉各部分的前6位数据，结果为`0000110101`和`0101000110`

   ③ 将两个结果进行合并（`0000110101|0101000110`），并转换为16进制表示，得到的结果为`U+D546`

   ④ 再加上`U+10000`，即为`U+1D546`

## UTF-8（用1个到4个字节表示一个Unicode字符）

1. 对于单个字节（只有其中的7位有效）就能表示的字符，字节的第1位为0，后面7位对应Unicode中相应的字符

2. 对于N个字节表示的字符，第1个字节的前N位都为1，第N+1位为0，后面字节的前两位都为10，剩下的所有字节一起组成Unicode中相应的字符

3. 如何将一个`Unicode`字符进行`UTF-8`编码呢？以`U+9A6C`为例

   ① 在下表中，找出该`Unicode`对于的字节数，可以`U+9A6C`为3个字节

   ② 将`U+9A6C`用二进制进行表示，为`1001|1010|0110|1100`

   ③ 从左往右将二进制数字填充到三个字节中，分别为`11101001`、`10101001`、`10101100`

4. 将`UTF-8`转换为`Unicode`的方法按上述过程逆推即可。

| Unicode字符集范围（十六进制） | UTF-8编码（二进制） |
|---- | ---- |
| 0000 0000 - 0000 007F | 0xxxxxxx |
| 0000 0080 - 0000 07FF | 110xxxxx 10xxxxxx |
| 0000 0800 - 0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx |
| 0001 0000 - 0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx |